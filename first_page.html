<html>
    <head>
        <meta charset="utf-8">
        
    </head>
<script src='https://d3js.org/d3.v5.min.js'></script>

<style> 
    circle {fill: lightblue; stroke: black;} 

    body,html{
        margin: 0;
        padding: 0;
        font-family: "Arial", sans-serif;
        font-size: 11px;
        text-align: center;
    }
  
    #my_dataviz {
        background-color: lightgrey;
        margin-top: 25px;
    }

    #page {
        margin-top: 25px;
    }

    div.tooltip {	
        position: absolute;			
        text-align: center;			
        width: 100px;					
        height: 50px;					
        padding: 2px;				
        font: 12px sans-serif;		
        background: lightsteelblue;	
        border: 0px;		
        border-radius: 8px;			
        pointer-events: none;			
}
</style>
    <body onload='loadGraph()'>

        <div><h1>Covid-19 Across the USA</h1></div>
        <div id="page">

            <div id="my_dataviz"></div>
            
            <div id="selector">
                <label for="date">Choose a DATE:</label>
                <select name="date" id="date" onchange="loadGraph()">
                <option value="07-25-2020" selected>07-25-2020</option>
                <option value="06-25-2020">06-25-2020</option>
                <option value="05-25-2020">05-25-2020</option>
                <option value="07-25-2020">07-25-2020</option>
            </div>
        
            
        </div>
<script>
async function loadGraph(){

    //clean the svg 

    d3.select("#my_dataviz").selectAll("*").remove()

    var w = 600;
    var h = 600;

    var margin = {
        top: 60,
        bottom: 40,
        left: 70,
        right: 40
    };
    
    
    var width = w - margin.left - margin.right;
    var height = h - margin.top - margin.bottom;

    // append the svg object to the body of the page
    var svg = d3.select("#my_dataviz")
    .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
    .append("g")
        .attr("transform",
            "translate(" + margin.left + "," + margin.top + ")");

    
    var date = document.getElementById("date").value;
    var data_url = null;
   
    console.log("date " + date)

    if(date == "07-25-2020"){
        data_url = "https://raw.githubusercontent.com/stemoor/CS498_NarrativeVisualizationProject/master/data/07-25-2020.csv"
    } else if (date == "06-25-2020"){
        data_url = "https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_daily_reports_us/06-25-2020.csv"
    } else if(date == "05-25-2020"){
        data_url = "https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_daily_reports_us/05-25-2020.csv"
    } else {     
        return
    }

    var data = await d3.csv(data_url)

      // Add X axis
    var x = d3.scaleLinear()
        .domain([ d3.min(data, function(d){return d.People_Tested; }),
            d3.max(data, function(d){ return d.People_Tested; })
        ])
        .range([ 0, width ]);

    svg.append("g")
        .attr("transform", "translate(0," + height + ")")
        .call(d3.axisBottom(x));

    // Add Y axis
    var y = d3.scaleLinear()
        .domain([ d3.min(data, function(d){ return d.Confirmed; }),
                d3.max(data, function(d){ return d.Confirmed; })
            ])
        .range([ height, 0]);

    svg.append("g")
        .call(d3.axisLeft(y));
    
        // Define the div for the tooltip
    var div = d3.select("#my_dataviz").append("div")	
        .attr("class", "tooltip")				
        .style("opacity", 0);

      // Add dots
    svg.append('g')
        .selectAll("dot")
        .data(data)
        .enter()
        .append("circle")
        .attr("cx", function (d) { return x(d.People_Tested); } )
        .attr("cy", function (d) { return y(d.Confirmed); } )
        .attr("r", 5)
        .style("fill", "#69b3a2")
        .on("mouseover", function(d) {		
            div.transition()		
                .duration(200)		
                .style("opacity", .9);		
            div.html(d.Province_State + "<br/>"  + "Tested=" + d.People_Tested + "<br/> Confirmed=" + d.Confirmed) 	
                .style("left", (d3.event.pageX) + "px")		
                .style("top", (d3.event.pageY - 28) + "px");	
            })					
        .on("mouseout", function(d) {		
            div.transition()		
                .duration(500)		
                .style("opacity", 0);	
        });

    // Add X axis label:
    svg.append("text")
        .attr("text-anchor", "end")
        .attr("x", width)
        .attr("y", height + margin.top)
        .text("X axis title");

    // Y axis label:
    svg.append("text")
        .attr("text-anchor", "end")
        .attr("transform", "rotate(-90)")
        .attr("y", -margin.left+20)
        .attr("x", -margin.top)
        .text("Y axis title")
}
</script>
    </body>
</html>
